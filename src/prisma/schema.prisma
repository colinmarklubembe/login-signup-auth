generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model User {
  id                      String                     @id @default(auto()) @map("_id") @db.ObjectId
  email                   String                     @unique
  password                String    
  name                    String    
  isVerified              Boolean?                   @default(false)
  verificationToken       String?
  forgotPasswordToken     String? 
  userOrganizationRoles   UserOrganizationRole[]     @relation("UserOrganizationRoles")
  userType                UserType                   @default(USER)
  // userOrganizations       UserOrganization[]         @relation("UserOrganizations")
  createdAt               DateTime?        
  updatedAt               DateTime?       
}

model Organization {
  id                      String                     @id @default(auto()) @map("_id") @db.ObjectId
  name                    String  
  // userId                  String                     @db.ObjectId        
  userOrganizationRoles   UserOrganizationRole[]     @relation("UserOrganizationRoles")
  departments             Department[]               @relation("OrganizationDepartments")
  // userOrganizations       UserOrganization[]         @relation("UserOrganizations")
  createdAt               DateTime? 
  updatedAt               DateTime? 
}

model Department {
  id                      String                     @id @default(auto()) @map("_id") @db.ObjectId
  name                    String    
  organizationId          String                     @db.ObjectId
  organization            Organization               @relation("OrganizationDepartments", fields: [organizationId], references: [id])
  createdAt               DateTime? 
  updatedAt               DateTime? 
}

model Role {
  id                      String                     @id @default(auto()) @map("_id") @db.ObjectId
  name                    String                     @unique
  permissions             RolePermission[]           @relation("RolePermissions")
  userOrganizationRoles   UserOrganizationRole[]     @relation("UserOrganizationRoles")
  createdAt               DateTime? 
  updatedAt               DateTime? 
}

model Permission {
  id                      String                     @id @default(auto()) @map("_id") @db.ObjectId
  name                    String                     @unique
  description             String?
  roles                   RolePermission[]           @relation("RolePermissions")
}

model RolePermission {
  id                      String                     @id @default(auto()) @map("_id") @db.ObjectId
  roleId                  String                     @db.ObjectId
  permissionId            String                     @db.ObjectId

  role                    Role                       @relation("RolePermissions", fields: [roleId], references: [id])
  permission              Permission                 @relation("RolePermissions", fields: [permissionId], references: [id])

  @@unique([roleId, permissionId])
}

model UserOrganizationRole {
  id                      String                     @id @default(auto()) @map("_id") @db.ObjectId
  userId                  String                     @db.ObjectId
  organizationId          String                     @db.ObjectId
  roleId                  String                     @db.ObjectId

  user                    User                       @relation("UserOrganizationRoles", fields: [userId], references: [id])
  organization            Organization               @relation("UserOrganizationRoles", fields: [organizationId], references: [id])
  role                    Role                       @relation("UserOrganizationRoles", fields: [roleId], references: [id])

  @@unique([userId, organizationId, roleId])
}

enum UserType {
  OWNER
  ADMIN
  USER
}
